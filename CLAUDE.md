# Claude-Specific Context

This document provides Claude Code (and other Claude-based AI tools) with specific context about this TanStack Router + Hono SSR template.

## Project Structure Quick Reference

```
tanstack-hono/
├── src/
│   ├── routes/              # File-based routes (auto-discovered)
│   │   ├── __root.tsx       # Root layout
│   │   ├── index.tsx        # Home page (/)
│   │   ├── about.tsx        # About page (/about)
│   │   └── -test.ts         # Non-route utility (- prefix)
│   ├── components/          # Reusable React components
│   ├── entry-client.tsx     # Client hydration entry
│   ├── entry-server.tsx     # Hono SSR server
│   ├── router.tsx           # Router config
│   ├── routeTree.gen.ts     # AUTO-GENERATED (don't edit)
│   └── styles.css           # Global styles + Tailwind
├── dist/                    # Build output (gitignored)
├── public/                  # Static assets
└── [config files]
```

## Tech Stack Context

### TanStack Router
- **Version**: v1.132+
- **Type**: File-based routing with SSR support
- **Key feature**: Type-safe navigation and data loading
- **Route generation**: Automatic via `@tanstack/router-plugin`

### Hono
- **Version**: v4.9+
- **Type**: Lightweight web framework (like Express but faster)
- **Why used**: Minimal overhead for SSR, edge-ready
- **Server location**: `src/entry-server.tsx`

### Vite
- **Build modes**: client (browser) and server (SSR)
- **Dev server**: Uses `@hono/vite-dev-server` plugin
- **Port**: 3000 (configurable via .env)

## Request Flow (SSR)

1. Browser requests URL → Hono server receives it
2. Hono passes to TanStack Router's `createRequestHandler`
3. Router matches route, runs loaders
4. React components render to HTML string via `renderRouterToString`
5. HTML sent to browser with embedded data
6. Client-side React hydrates and takes over

## Code Conventions

### Route Files
Routes export a `Route` object created with `createFileRoute`:

```tsx
// src/routes/example.tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/example')({
  component: ExampleComponent,
  // Optional: data loading
  loader: async () => ({ data: 'value' }),
})

function ExampleComponent() {
  return <div>Example</div>
}
```

### Component Style
Use **function declarations** for components (not arrow functions for named exports):
```tsx
// Preferred
function MyComponent() { }

// Avoid for named exports
const MyComponent = () => { }
```

### Imports
- Use relative imports for local files
- No path aliases configured by default
- Import from `@tanstack/react-router` for routing

## Environment Variables

**Server-side only** (access via `process.env`):
- `NODE_SERVER_PORT` - Server port (default: 3000)
- `NODE_SERVER_HOST` - Server host (default: localhost)
- `NODE_ENV` - Environment (production/development)

**Client-side** (must be prefixed with `VITE_`):
- Any `VITE_*` variable is embedded in client bundle

## Common Development Tasks

### Adding a New Route
```bash
# 1. Create file
touch src/routes/new-route.tsx

# 2. Add route export (see Route Files section)
# 3. Route tree regenerates automatically
```

### Adding an API Endpoint
Edit `src/entry-server.tsx`:
```tsx
app.get('/api/data', async (c) => {
  return c.json({ message: 'Hello' })
})
```

### Adding Middleware
In `src/entry-server.tsx`:
```tsx
import { myMiddleware } from 'hono/middleware'
app.use(myMiddleware())
```

### Styling with Tailwind
- Tailwind v4 is configured
- Use utility classes directly in JSX
- Add custom styles in `src/styles.css`

## Build System

### Development
```bash
npm run dev  # Starts Vite dev server on port 3000
```
- Uses `@hono/vite-dev-server` for SSR in dev
- Hot reload enabled

### Production Build
```bash
npm run build  # Runs 3 sub-commands:
# 1. build:client - Browser bundle → dist/client/
# 2. build:server - SSR bundle → dist/
# 3. build:types  - Type checking
```

### Starting Production
```bash
npm start  # Runs: NODE_ENV=production node dist/server
```

## Testing

- **Framework**: Vitest + Testing Library
- **Config**: `vite.config.ts` includes Vitest setup
- **Run**: `npm test`

## Important: Auto-Generated Files

**Never edit these files directly:**
- `src/routeTree.gen.ts` - Generated by TanStack Router plugin
- Any `*.gen.*` files

## Hono Server Details

Located in `src/entry-server.tsx`:

```tsx
const app = new Hono()

// Middleware
app.use(logger())       // Request logging
app.use(cors())         // CORS headers
app.use(compress())     // Gzip compression (production only)

// Static file serving (production only)
app.use('/assets/*', serveStatic({ root: './dist/client/static' }))

// SSR handler (catches all routes)
app.use('*', createRequestHandler({ ... }))
```

## Error Handling

Add error boundaries in routes:
```tsx
export const Route = createFileRoute('/example')({
  component: ExampleComponent,
  errorComponent: ({ error }) => <div>Error: {error.message}</div>,
})
```

## Key Dependencies

- `@tanstack/react-router` - Routing
- `hono` - Web framework
- `@hono/node-server` - Node.js adapter for Hono
- `react` & `react-dom` - React 19
- `tailwindcss` - Styling
- `@biomejs/biome` - Linting/formatting
- `vitest` - Testing

## Docker Support

- **Production**: Multi-stage build in `Dockerfile`
- **Development**: `docker-compose.yml` with hot reload
- **Commands**:
  ```bash
  docker-compose up app      # Production build
  docker-compose --profile dev up dev  # Development mode
  ```

## When Making Changes

1. **Routes**: Add files to `src/routes/`, route tree regenerates
2. **API**: Add endpoints in `entry-server.tsx`
3. **Components**: Add to `src/components/`
4. **Styles**: Edit `src/styles.css` or use Tailwind classes
5. **Config**: Edit `vite.config.ts` for build settings

## Common Gotchas

1. **Client vs Server code**: Be careful what runs where
   - Server: `entry-server.tsx` and route loaders
   - Client: `entry-client.tsx` and component code
   - Both: Component render functions

2. **Route tree regeneration**: Happens automatically, but may need to restart dev server if it doesn't

3. **Environment variables**: Remember `VITE_` prefix for client-side vars

4. **Static assets**: In production, served from `dist/client/`

## Performance Optimization Tips

- Use `React.lazy()` for code splitting
- Add `loader` to routes for data prefetching
- Use Hono's `compress()` middleware
- Optimize images before adding to project
- Consider edge deployment (Cloudflare Workers)

## Useful Commands

```bash
npm run dev              # Start dev server
npm run build            # Full production build
npm start                # Run production server
npm test                 # Run tests
npm run check            # Lint + format check
npm run format           # Format code with Biome
npm run lint             # Lint code with Biome
npm run build:analyze    # Analyze bundle size
```

## Related Documentation

- Full AI agent guide: [AGENTS.md](AGENTS.md)
- Architecture deep-dive: [ARCHITECTURE.md](ARCHITECTURE.md)
- Contributing: [CONTRIBUTING.md](CONTRIBUTING.md)
- Main README: [README.md](README.md)
