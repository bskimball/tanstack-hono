# AI Agent Guidelines

This document provides guidance for AI agents (like Claude, Cursor, Copilot) working with this TanStack Router + Hono SSR codebase.

## Project Overview

This is a full-stack React application using:
- **TanStack Router** for type-safe, file-based routing with SSR
- **Hono** as the lightweight web framework for server-side rendering
- **Vite** for build tooling and development server
- **TypeScript** for type safety across client and server
- **Tailwind CSS v4** for styling
- **Biome** for linting and formatting
- **Vitest** for testing

## Architecture

### Entry Points
- `src/entry-client.tsx` - Client-side hydration entry point
- `src/entry-server.tsx` - Hono server with SSR setup
- `src/router.tsx` - Router configuration

### Routing
- **File-based routing**: Routes are in `src/routes/`
- **Root route**: `src/routes/__root.tsx` contains the root layout
- **Route generation**: `src/routeTree.gen.ts` is auto-generated by TanStack Router plugin
- **Special files**: Files starting with `-` (like `-test.ts`) are not routes

### Build Process
The build happens in three stages:
1. `build:client` - Builds client bundle to `dist/client/`
2. `build:server` - Builds server bundle to `dist/`
3. `build:types` - Type checks with TypeScript

## Key Patterns

### Adding New Routes
1. Create file in `src/routes/` (e.g., `src/routes/blog.tsx`)
2. Use `createFileRoute` to define the route:
```tsx
import { createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/blog')({
  component: BlogPage,
})

function BlogPage() {
  return <div>Blog</div>
}
```
3. Route tree regenerates automatically

### Data Loading
Routes can load data with the `loader` function:
```tsx
export const Route = createFileRoute('/users')({
  loader: async () => {
    const users = await fetch('/api/users').then(r => r.json())
    return { users }
  },
  component: UsersPage,
})
```

### API Routes
Add Hono routes in `src/entry-server.tsx`:
```tsx
app.get('/api/users', (c) => {
  return c.json({ users: [] })
})
```

### Environment Variables
- Use `.env` for local development
- All variables are in `.env.example`
- Access via `process.env.VARIABLE_NAME`

## Important Files to NOT Modify

- `src/routeTree.gen.ts` - Auto-generated, will be overwritten
- Do not edit directly; it's generated from route files

## Testing

- Use Vitest for unit and integration tests
- Test files should be `*.test.tsx` or `*.test.ts`
- Run tests with `npm test`

## Code Style

- **Formatting**: Biome handles formatting (not Prettier)
- **Imports**: Use absolute imports from `src/`
- **Types**: Prefer interfaces over types for objects
- **Components**: Use function declarations, not arrow functions for named components
- **File naming**: Use kebab-case for file names

## Common Tasks

### Add a new page route
1. Create `src/routes/page-name.tsx`
2. Export route with `createFileRoute('/page-name')`
3. Add component

### Add an API endpoint
1. Add route in `src/entry-server.tsx`
2. Use Hono's request/response API
3. Return JSON with `c.json()`

### Add global styles
1. Edit `src/styles.css`
2. Use Tailwind's `@layer` directive for custom utilities

### Update dependencies
```bash
npm run update-all  # Updates all dependencies
```

## Performance Considerations

- SSR is enabled by default for SEO and initial load performance
- Static assets are served from `dist/client/` in production
- Compression is enabled via Hono middleware in production
- Use React.lazy() for code splitting if needed

## Deployment

The app can be deployed to:
- **Docker**: Use the included Dockerfile
- **Vercel/Netlify**: Serverless functions
- **Railway/Render**: Container deployments
- **Cloudflare Workers**: Edge runtime

## Common Pitfalls

1. **Forgetting to await loaders**: Route loaders must be async functions
2. **Importing server code in client**: Keep server logic in entry-server.tsx
3. **Not handling errors**: Use error boundaries in routes
4. **Env vars in client**: Client code cannot access all env vars (only those prefixed with `VITE_`)

## Getting Help

- Check [TanStack Router docs](https://tanstack.com/router)
- Check [Hono docs](https://hono.dev)
- Review existing routes in `src/routes/` for patterns
- See [CLAUDE.md](CLAUDE.md) for Claude-specific tips
